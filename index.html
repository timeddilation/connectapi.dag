<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Design task orchestration for jobs in Posit Connect.
    Use semantics similar to AirFlow, but specifically for Connect and written in R.">
<title>Task Orchestration for Posit Connect • connectapi.dag</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Task Orchestration for Posit Connect">
<meta property="og:description" content="Design task orchestration for jobs in Posit Connect.
    Use semantics similar to AirFlow, but specifically for Connect and written in R.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">connectapi.dag</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/connect-tasks.html">Connect Tasks</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="connectapidag">connectapi.dag<a class="anchor" aria-label="anchor" href="#connectapidag"></a>
</h1></div>
<p>This package allows for the creation of DAGs, inspired by Apache Airflow, for content items published to <a href="https://docs.posit.co/rsc/" class="external-link">Posit Connect</a>. It leverages the existing <a href="https://github.com/rstudio/connectapi" class="external-link">connectapi</a> package to make API calls to your Posit Server, and adds syntax similar to Airflow’s python package for defining your DAGs.</p>
<p>A DAG is a collection of linked tasks, organized with dependencies and relationships that describe the rules for how and when they should run.</p>
<p>The main benefit of using this package is to not have to manage so many rendering schedules in Posit Connect. You may often find yourself having jobs dependent on another job, and creating one or two hour offsets for their schedules to ensure the completion of one before the other. This can lead to many issues in data pipelines, especially when a dependency task fails you may not want dependent tasks to run at all.</p>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>Because this package relies entirely the <code>connectapi</code> to interact with your Posit Connect Server, all of the same disclaimers that package states are applicable here as well. The <code>connectapi</code> package is itself experimental.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package is not currently available on CRAN.</p>
<p>To install the development version:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"timeddilation/connectapi.dag"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>Before starting here, it is highly recommended you familiarize yourself with <a href="https://github.com/rstudio/connectapi" class="external-link">connectapi</a> briefly. The most important aspect to understand is how the client is created. By default, this package looks for environment variables containing the secrets required to connect to your Posit Connect server.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>CONNECT_SERVER <span class="ot">=</span> https<span class="sc">:</span><span class="er">//</span>connect.example.com</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>CONNECT_API_KEY <span class="ot">=</span> your<span class="sc">-</span>api<span class="sc">-</span>key</span></code></pre></div>
<p>It is highly recommended you use these exact environment variables for authentication, as they are used by both <code>connectapi</code> and <code>pins</code>.</p>
<p>Once you have the basics figured out with <code>connectapi</code>, and you can create a connect client using <code><a href="https://rdrr.io/pkg/connectapi/man/connect.html" class="external-link">connectapi::connect()</a></code> you can start defining <strong>tasks</strong> and <strong>DAGs</strong>.</p>
<p>Secondly, it is suggested to familiarize yourself with <a href="https://github.com/rstudio/pins-r" class="external-link">pins</a>. Specifically, this package uses <code><a href="https://pins.rstudio.com/reference/board_connect.html" class="external-link">pins::board_connect()</a></code> under the hood for managing DAG deployments to Posit Connect. Although, it is not required to use this package’s built-in features for DAG deployments, as you can do whatever you want with the DAG environment once it has been defined.</p>
<p>In order to use the defaults with above environment variables, <code>pins</code> V &gt;= 1.1.0 is required.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Create and deploy DAGs to orchestrate scheduled jobs on Posit Connect in 4 steps:</p>
<ul>
<li>Define Tasks and dependency chains</li>
<li>Define a DAG as a collection of tasks</li>
<li>Store the DAG in persistent storage using pins</li>
<li>Schedule the DAG to run, and remove schedules from individual tasks</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://timeddilation.github.io/connectapi.dag/">connectapi.dag</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define Tasks</span></span>
<span><span class="co"># Use `simulated = TRUE` to skip Posit Validation</span></span>
<span><span class="co"># Real Connect Tasks must be defined with `simulated = FALSE` (the default)</span></span>
<span><span class="va">task0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"guid-0"</span>, simulated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">task1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"guid-1"</span>, simulated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">task2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"guid-2"</span>, simulated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">task3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"guid-3"</span>, simulated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">task4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"guid-4"</span>, trigger_rule <span class="op">=</span> <span class="st">"one_success"</span>, simulated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define dependency chain</span></span>
<span><span class="va">task1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_upstream.html">set_upstream</a></span><span class="op">(</span><span class="va">task0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_downstream.html">set_downstream</a></span><span class="op">(</span><span class="va">task2</span>, <span class="va">task3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">task4</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_upstream.html">set_upstream</a></span><span class="op">(</span><span class="va">task2</span>, <span class="va">task3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create the DAG</span></span>
<span><span class="va">my_dag</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/connect_dag.html">connect_dag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/dag_add_tasks.html">dag_add_tasks</a></span><span class="op">(</span><span class="va">task0</span>, <span class="va">task1</span>, <span class="va">task2</span>, <span class="va">task3</span>, <span class="va">task4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/dag_set_name.html">dag_set_name</a></span><span class="op">(</span><span class="st">"simulated_dag"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/dag_validate.html">dag_validate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save the DAG to Posit Connect as a pin</span></span>
<span><span class="fu"><a href="reference/dag_write_connect_pin.html">dag_write_connect_pin</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a deployment Rmd to read the DAG from storage and execute</span></span>
<span><span class="fu"><a href="reference/dag_write_rmd.html">dag_write_rmd</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
<p>Open the created Rmd file and click to deploy to Connect!</p>
</div>
<div class="section level2">
<h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h2>
<div class="section level3">
<h3 id="tasks">Tasks<a class="anchor" aria-label="anchor" href="#tasks"></a>
</h3>
<p>The most fundamental part of creating a DAG is to define the tasks you want included in the DAG. The tasks are created by specifying the GUID of the content item published to your Posit Connect server, with an option for the <em>trigger_rule</em> to follow. By default, the <em>trigger_rule</em> is <strong>all_success</strong>, meaning all predecessor tasks completed successfully. View the man page of the <code>connect_task</code> function for a list of all available trigger rules.</p>
<p>If a task has no predecessors, it will always run. The <code>connect_task</code> function returns an R6 environment that manages the state of the task.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"4af62803-c9aa-45f4-8336-0ea7bbdd9334"</span><span class="op">)</span></span>
<span><span class="va">task1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"711b8c7a-97ef-4343-9e55-0d4d426ebf59"</span><span class="op">)</span></span>
<span><span class="va">task2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_task.html">connect_task</a></span><span class="op">(</span><span class="st">"eda729a2-e3f1-4063-b606-e52d01e9aa23"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="task-dependencies">Task Dependencies<a class="anchor" aria-label="anchor" href="#task-dependencies"></a>
</h4>
<p>Two functions are provided to create dependencies: <code><a href="reference/set_upstream.html">set_upstream()</a></code> and <code><a href="reference/set_downstream.html">set_downstream()</a></code>. For each of these functions, they may accept any number of tasks to set as dependencies.</p>
<p>For example, the following will make <em>task1</em> and <em>task2</em> dependent on <em>task0</em> completing.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task0</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_downstream.html">set_downstream</a></span><span class="op">(</span><span class="va">task1</span>, <span class="va">task2</span><span class="op">)</span></span></code></pre></div>
<p>You can visualize a task’s immediate dependencies and dependents by plotting it:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">task0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="simulated-tasks">Simulated Tasks<a class="anchor" aria-label="anchor" href="#simulated-tasks"></a>
</h4>
<p>For simple happy-path testing, you may use <code>simulated = TRUE</code> parameter in the <code><a href="reference/connect_task.html">connect_task()</a></code> function. Simulated tasks created this way will always run successfully and skip validation with Posit Connect.</p>
<p>To test what happens in failure scenarios, you may instead use the <code><a href="reference/sim_task.html">sim_task()</a></code> function. This function also creates a simulated ConnectTask environment, but allows you to specify a probability of failure.</p>
<p>This gives you a great way to visualize what happens under failure scenarios.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_task0</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_task.html">sim_task</a></span><span class="op">(</span><span class="st">"guid-0"</span>, fail_prob <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sim_task1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_task.html">sim_task</a></span><span class="op">(</span><span class="st">"guid-1"</span>, fail_prob <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sim_task2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_task.html">sim_task</a></span><span class="op">(</span><span class="st">"guid-2"</span>, fail_prob <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">sim_task3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_task.html">sim_task</a></span><span class="op">(</span><span class="st">"guid-3"</span>, fail_prob <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_task4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sim_task.html">sim_task</a></span><span class="op">(</span><span class="st">"guid-4"</span>, trigger_rule <span class="op">=</span> <span class="st">"one_success"</span>, fail_prob <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define dependency chain</span></span>
<span><span class="va">sim_task1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_upstream.html">set_upstream</a></span><span class="op">(</span><span class="va">sim_task0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_downstream.html">set_downstream</a></span><span class="op">(</span><span class="va">sim_task2</span>, <span class="va">sim_task3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_task4</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/set_upstream.html">set_upstream</a></span><span class="op">(</span><span class="va">sim_task2</span>, <span class="va">sim_task3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_dag</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="reference/connect_dag.html">connect_dag</a></span><span class="op">(</span><span class="va">sim_task0</span>, <span class="va">sim_task1</span>, <span class="va">sim_task2</span>, <span class="va">sim_task3</span>, <span class="va">sim_task4</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/dag_validate.html">dag_validate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/dag_run.html">dag_run</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_dag</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="dags">DAGs<a class="anchor" aria-label="anchor" href="#dags"></a>
</h3>
<p>Once all tasks are defined, you may add them to a DAG R6 environment. This object will validate the tasks are in fact linked as a DAG. You may create task dependencies before or after creating the DAG.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/connect_dag.html">connect_dag</a></span><span class="op">(</span><span class="va">task0</span>, <span class="va">task1</span>, <span class="va">task2</span>, name <span class="op">=</span> <span class="st">"my_dag"</span><span class="op">)</span></span></code></pre></div>
<p>Note: All tasks that are linked in the dependency chain must be added to the DAG. The DAG will not validate if it detects a task has a dependency link, and that task is not added to the DAG.</p>
<p>With the DAG object created, you can check the validity of the DAG. If any issues are found, a message will return in the console for why it is invalid. It is recommended you always run <code>dag_validate</code> on a DAG before storing it or trying to execute it. When a DAG is executed, it will check validity and raise an error if the DAG is invalid.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dag_validate.html">dag_validate</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
<p>You may also plot the DAG. By default, the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method on the DAG will create a plotly graph. You may plot the DAG even when the DAG is invalid. This can be useful when troubleshooting circular references, islands, or other issues in the DAG.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-dags">Running DAGs<a class="anchor" aria-label="anchor" href="#running-dags"></a>
</h3>
<p>Once you have a valid DAG, you can run it simply with the <code>dag_run</code> function. Calling this from a local environment will execute the tasks in the DAG. However, this does not yet schedule the DAG as a whole. Keep reading below for deployment options.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dag_run.html">dag_run</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
<p>After it has ran, you can <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> the DAG again to show task statuses. Tasks have 3 possible statuses after DAG runs; <em>Succeeded</em>, <em>Failed</em>, and <em>Skipped</em>. A task will be skipped if it’s <em>trigger_rule</em> requirement is not met.</p>
<p>If you ever run into issues executing a DAG, it may be useful to plot the DAG to see where the issue arrised.</p>
</div>
<div class="section level3">
<h3 id="storing-dags">Storing DAGs<a class="anchor" aria-label="anchor" href="#storing-dags"></a>
</h3>
<p>Once a DAG is defined, you will want to save it to persistent storage so you can later retrieve it to run it again. You can use any method you want for this portion, as you can simply save the DAG environment with <code>saveRDS</code>. For instance, if you want to use S3 for your persistent storage and versioning, you can use the <code>paws.storage</code> package instead. Or, you can save the DAG as an RDS object in your project’s repository, and include it in the bundle you publish to Posit Connect.</p>
<p>However, since this package is explicitly for Posit Connect, integration to use Posit Connect persistent storage with the <code>pins</code> package is already built-in.</p>
<p>The <code><a href="reference/dag_write_connect_pin.html">dag_write_connect_pin()</a></code> function handles most of the work for you. The DAG environment has a <code>pin_name</code> attribute, which can be changed with the <code><a href="reference/dag_set_pin_name.html">dag_set_pin_name()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dag_write_connect_pin.html">dag_write_connect_pin</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="scheduling-dags">Scheduling DAGs<a class="anchor" aria-label="anchor" href="#scheduling-dags"></a>
</h3>
<p>Scheduling a DAG works the same way as scheduling any other job on Posit Connect. You must publish a bundle that can be rendered (Rmd, quarto, jupyter, etc.) that will read the DAG environment and call the <code>run_dag()</code> method on it.</p>
<p>This package simplifies the process if you’re also using pins on Connect for persistent storage. After saving the DAG to Connect using pins, you can use <code><a href="reference/dag_write_rmd.html">dag_write_rmd()</a></code> function to generate the Rmd file needed to execute and schedule the DAG.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/dag_write_rmd.html">dag_write_rmd</a></span><span class="op">(</span><span class="va">my_dag</span><span class="op">)</span></span></code></pre></div>
<p>Note that this function requires the original DAG environment. The DAG contains the name of the pin on Posit Connect. This function will first validate the pin exists on your Posit Connect Server. Once validated, it will compose the entire job that you can then publish and schedule.</p>
<p>Once published and scheduled, you can remove any schedules you have on existing tasks within your DAG.</p>
<p>Part of the defaults for this job is to save the DAG again, overwriting and versioning the existing DAG. It is imperative the DAG’s <code>pin_name</code> is identical to the pin it is reading. When this job reads the DAG, it will first reset the DAG using <code><a href="reference/dag_reset.html">dag_reset()</a></code>, which resets all task statuses and the DAG’s internal state.</p>
<p>This allows you to have a log of all previous DAG runs, and which tasks succeeded, failed, or skipped. It is planned for the future to introduce functions and tools to read previous versions of the DAGs and view all the tasks states for prior runs to allow investigation of issues, and possibly the ability to re-run specific tasks.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-notes">Other Notes<a class="anchor" aria-label="anchor" href="#other-notes"></a>
</h2>
<p>Tasks that the DAG runs follow any settings you have created for those tasks. For instance, email on failure will still occur if the task render fails. The DAG job itself does not raise errors when a task fails, as it expects some tasks might fail.</p>
</div>
<div class="section level2">
<h2 id="future-plans">Future Plans<a class="anchor" aria-label="anchor" href="#future-plans"></a>
</h2>
<p>A Shiny application may be built to list all published DAGs, view the history of DAG executions, plot them, re-run them, and provide other administration features. This shiny app may be ran locally, in workbench, or as a deployed app on Posit Connect.</p>
<p>Currently, tasks in a DAG cannot be run concurrently, even when it should be possible to be running multiple tasks at the same time. This is a major optimization that can be made, but requires a lot of thought and planning to execute correctly and give the user proper control of that behavior. When this tool becomes more mature, this kind of feature will be added.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing connectapi.dag</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Tyler Neumann <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/timeddilation/connectapi.dag/actions" class="external-link"><img src="https://github.com/timeddilation/connectapi.dag/actions/workflows/check-standard.yaml/badge.svg" alt="R build status"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tyler Neumann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
